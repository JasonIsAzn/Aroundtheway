<!DOCTYPE html>
<html>
<head>
    <title>Product Image Upload Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="file"] { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .images { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .image-item { border: 1px solid #ddd; padding: 10px; border-radius: 4px; }
        .image-item img { max-width: 200px; max-height: 200px; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Product Image Upload Test</h1>

        <!-- Upload Single Image -->
        <h2>Upload Single Image</h2>
        <form id="singleUploadForm">
            <div class="form-group">
                <label for="productId1">Product ID:</label>
                <input type="text" id="productId1" value="test-product-001" required>
            </div>
            <div class="form-group">
                <label for="singleFile">Select Image:</label>
                <input type="file" id="singleFile" accept="image/*" required>
            </div>
            <button type="submit">Upload Single Image</button>
        </form>

        <!-- Upload Multiple Images -->
        <h2>Upload Multiple Images</h2>
        <form id="multipleUploadForm">
            <div class="form-group">
                <label for="productId2">Product ID:</label>
                <input type="text" id="productId2" value="test-product-001" required>
            </div>
            <div class="form-group">
                <label for="multipleFiles">Select Images (max 10):</label>
                <input type="file" id="multipleFiles" accept="image/*" multiple required>
            </div>
            <button type="submit">Upload Multiple Images</button>
        </form>

        <!-- Get Product Images -->
        <h2>View Product Images</h2>
        <form id="getImagesForm">
            <div class="form-group">
                <label for="productId3">Product ID:</label>
                <input type="text" id="productId3" value="test-product-001" required>
            </div>
            <button type="submit">Get Product Images</button>
        </form>

        <!-- Results -->
        <div id="result"></div>
        <div id="images"></div>
    </div>

    <script>
        const apiBase = 'http://localhost:5000/api/ProductImage';

        // Single upload
        document.getElementById('singleUploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('productId1').value;
            const file = document.getElementById('singleFile').files[0];

            const formData = new FormData();
            formData.append('file', file);

            try {
                showResult('Uploading...', 'info');
                const response = await fetch(`${apiBase}/upload/${productId}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    showResult(`✅ Upload successful! File: ${result.fileName}`, 'success');
                } else {
                    showResult(`❌ Upload failed: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        });

        // Multiple upload
        document.getElementById('multipleUploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('productId2').value;
            const files = document.getElementById('multipleFiles').files;

            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }

            try {
                showResult('Uploading multiple images...', 'info');
                const response = await fetch(`${apiBase}/upload-multiple/${productId}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    showResult(`✅ Uploaded ${result.count} images successfully!`, 'success');
                } else {
                    showResult(`❌ Upload failed: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        });

        // Get images
        document.getElementById('getImagesForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('productId3').value;

            try {
                showResult('Loading images...', 'info');
                const response = await fetch(`${apiBase}/${productId}/images`);
                const result = await response.json();

                if (result.success) {
                    showResult(`✅ Found ${result.count} images for product ${productId}`, 'success');
                    displayImages(result.images);
                } else {
                    showResult(`❌ Failed to get images: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        });

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        function displayImages(images) {
            const imagesDiv = document.getElementById('images');
            imagesDiv.innerHTML = '<h3>Product Images:</h3>';

            if (images.length === 0) {
                imagesDiv.innerHTML += '<p>No images found.</p>';
                return;
            }

            const imagesContainer = document.createElement('div');
            imagesContainer.className = 'images';

            images.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${image.imageUrl}" alt="${image.fileName}" />
                    <small>${image.fileName}</small>
                `;
                imagesContainer.appendChild(imageItem);
            });

            imagesDiv.appendChild(imagesContainer);
        }
    </script>
</body>
</html>